
@if (featuredProfile(); as featured) {
  <!-- Intro Animation Overlay -->
  @if (introActive()) {
    <div class="intro-overlay fixed inset-0 z-50 flex items-center justify-center overflow-hidden"
         [class.intro-fade-out]="!introActive()"
         [style.--bg-start]="featured.theme.bgStart"
         [style.--bg-end]="featured.theme.bgEnd">
      <app-intro-particles 
        (heartFormed)="onHeartFormed()" 
        (explosionComplete)="onExplosionComplete()">
      </app-intro-particles>
    </div>
  }

  <!-- Main Hero Content -->
  <div class="relative min-h-screen overflow-x-hidden transition-colors duration-700 theme-surface hero-container" 
       [class.hero-hidden]="introActive()"
       [class.hero-visible]="!introActive()"
       [style.--accent]="featured.theme.accent"
       [style.--accent-rgb]="featured.theme.accentRGB"
       [style.--bg-start]="featured.theme.bgStart"
       [style.--bg-end]="featured.theme.bgEnd"
       [style.--surface-rgb]="featured.theme.surfaceRGB"
       [style.--text]="featured.theme.text"
       [style.--muted]="featured.theme.muted"
       [style.--btn-bg]="featured.theme.btnBg"
       [style.--btn-text]="featured.theme.btnText"
       [style.--btn-border]="featured.theme.btnBorder"
       [style.--accent-soft]="featured.theme.accentSoft"
       >
    <app-header />
    
    <main>
      @if (selectedProfile(); as profile) {
        <div class="px-4 md:px-8 lg:px-12 py-8">
          <app-profile-detail 
            [profile]="profile" 
            (close)="deselectProfile()" 
          />
        </div>
      } @else {
        
          <!-- Hero Section -->
          <section 
            (mouseenter)="stopSlider()" 
            (mouseleave)="startSlider()"
            class="min-h-screen flex items-center relative overflow-hidden px-4 md:px-8 lg:px-12 py-12">
            
            <app-particle-background 
              [accent]="featured.theme.accent" 
              [accentRgb]="featured.theme.accentRGB" 
              [swapTrigger]="particleTrigger()"
            />
            <div class="absolute inset-0 bg-gradient-to-r from-black/60 via-[#0b1020]/50 to-black/30 pointer-events-none z-10"></div>

            <div class="container mx-auto z-10 relative">
              @for (profile of profiles(); track profile.id) {
                @if (profile.id === featured.id) {
                  <div class="grid lg:grid-cols-3 gap-6 items-start">
                    <!-- Left Column: Headline & CTAs -->
                    <div class="lg:col-span-1 text-center lg:text-left space-y-3 hero-animate hero-content" [class.transition-blur]="isTransitioning()">
                      <p class="text-xs tracking-widest text-[var(--accent)] hero-identity">
                        {{ dynamicHeroContent().identity }}
                      </p>
                      <div class="flex flex-wrap items-center gap-2 justify-center lg:justify-start hero-status">
                        <span
                          class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold uppercase tracking-wide bg-[var(--accent-soft)] text-[var(--accent)] status-chip"
                          [class.pulse]="featured.status === 'online'"
                        >
                          <span class="w-2 h-2 rounded-full bg-[var(--accent)]"></span>
                          {{ featured.status === 'online' ? 'Online' : 'Soon' }}
                        </span>
                        @if (profile.verified !== false) {
                          <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                              <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            Verified
                          </span>
                        }
                        <span class="text-xs text-[var(--muted)]">{{ dynamicHeroStats().rating }}★</span>
                      </div>
                      <h1 class="text-2xl md:text-3xl lg:text-4xl font-medium text-[var(--text)] leading-tight hero-headline">
                        {{ dynamicHeroContent().headline }}
                      </h1>
                      <p class="text-sm text-[var(--muted)] hero-subline line-clamp-2">
                        {{ dynamicHeroContent().subline }}
                      </p>
                      <div class="flex flex-col gap-2 mt-4 hero-buttons">
                        <button (click)="selectProfile(profile.id)" 
                                [class.cta-sleeping]="!ctaAwake()"
                                [class.cta-awake]="ctaAwake()"
                                class="w-full border-2 border-[var(--btn-border)] text-[var(--accent)] font-bold uppercase tracking-wide px-6 py-3 rounded-full hover:bg-[var(--btn-bg)] hover:text-[var(--btn-text)] transition-all duration-300 hover:scale-105 cta-shimmer text-xs cta-button">
                          <span class="cta-text">Chat with {{ profile.name }}</span>
                        </button>
                        <button (click)="openHeroGallery()" class="w-full px-6 py-3 rounded-full font-semibold uppercase tracking-wide text-xs text-white bg-gradient-to-r from-[var(--accent)] to-[var(--accent-soft)] hover:shadow-lg transition-all duration-300">
                          Gallery
                        </button>
                      </div>
                    </div>

                    <!-- Middle Column: Image Gallery -->
                    <div class="lg:col-span-1 relative hidden lg:flex justify-center items-center hero-content h-[65vh]" [class.transition-blur]="isTransitioning()">
                      <div class="w-full flex items-center justify-between gap-4 h-full">
                        
                        <!-- Left Thumbnails Strip -->
                        <div class="flex flex-col gap-3 h-full overflow-y-auto no-scrollbar py-2 w-16 flex-shrink-0">
                          @for (img of currentGalleryImages(); track img; let i = $index) {
                            @if (i % 2 === 0) {
                              <button (click)="setGalleryImage(i)" 
                                      class="relative w-14 h-20 rounded-lg overflow-hidden border-2 transition-all duration-300 hover:scale-105"
                                      [class.border-[var(--accent)]]="i === activeGalleryIndex()"
                                      [class.border-transparent]="i !== activeGalleryIndex()"
                                      [class.opacity-50]="i !== activeGalleryIndex()"
                                      [class.opacity-100]="i === activeGalleryIndex()">
                                <img [src]="img" class="w-full h-full object-cover">
                              </button>
                            }
                          }
                        </div>

                        <!-- Main Image Area -->
                        <div class="relative flex-1 h-full rounded-2xl overflow-hidden group">
                           <!-- Navigation Arrows -->
                           <button (click)="prevGalleryImage($event)" class="absolute left-2 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-black/40 text-white hover:bg-[var(--accent)] transition-colors opacity-0 group-hover:opacity-100 backdrop-blur-sm">
                              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                           </button>
                           <button (click)="nextGalleryImage($event)" class="absolute right-2 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-black/40 text-white hover:bg-[var(--accent)] transition-colors opacity-0 group-hover:opacity-100 backdrop-blur-sm">
                              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                           </button>

                           @for (img of currentGalleryImages(); track img; let i = $index) {
                             <div class="absolute inset-0 transition-opacity duration-500 ease-in-out"
                                  [class.opacity-100]="i === activeGalleryIndex()"
                                  [class.opacity-0]="i !== activeGalleryIndex()"
                                  [class.pointer-events-none]="i !== activeGalleryIndex()">
                               <img [src]="img" class="w-full h-full object-cover">
                               <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent pointer-events-none"></div>
                             </div>
                           }
                        </div>

                        <!-- Right Thumbnails Strip -->
                        <div class="flex flex-col gap-3 h-full overflow-y-auto no-scrollbar py-2 w-16 flex-shrink-0">
                          @for (img of currentGalleryImages(); track img; let i = $index) {
                            @if (i % 2 !== 0) {
                              <button (click)="setGalleryImage(i)" 
                                      class="relative w-14 h-20 rounded-lg overflow-hidden border-2 transition-all duration-300 hover:scale-105"
                                      [class.border-[var(--accent)]]="i === activeGalleryIndex()"
                                      [class.border-transparent]="i !== activeGalleryIndex()"
                                      [class.opacity-50]="i !== activeGalleryIndex()"
                                      [class.opacity-100]="i === activeGalleryIndex()">
                                <img [src]="img" class="w-full h-full object-cover">
                              </button>
                            }
                          }
                        </div>

                      </div>
                    </div>

                    <!-- Right Column: Compact Details -->
                    <div class="lg:col-span-1 space-y-3 text-sm hero-content" [class.transition-blur]="isTransitioning()">
                      <!-- Bio -->
                      <div class="glass-panel rounded-xl p-4 right-col-item glass-highlight" [class.loaded]="cardsLoaded()">
                        <h3 class="text-xs font-semibold text-[var(--accent)] uppercase mb-2">About</h3>
                        <p class="text-xs text-[var(--muted)] line-clamp-4 leading-relaxed">
                          @if (profile.extendedBio) {
                            {{ profile.extendedBio }}
                          } @else {
                            {{ profile.bio }}
                          }
                        </p>
                      </div>

                      <!-- Interests -->
                      <div class="glass-panel rounded-xl p-4 right-col-item glass-highlight interests-card" [class.loaded]="cardsLoaded()">
                        <h3 class="text-xs font-semibold text-[var(--accent)] uppercase mb-2">Interests</h3>
                        <div class="flex flex-wrap gap-1.5">
                          @for (interest of profile.interests.slice(0, 6); track interest) {
                            <span class="px-2 py-0.5 rounded-full text-xs bg-[var(--accent-soft)]/30 text-[var(--accent)]">
                              {{ interest }}
                            </span>
                          }
                        </div>
                      </div>

                      <!-- Special Offer -->
                      @if (profile.specialOffer) {
                        <div class="glass-panel rounded-xl p-4 bg-gradient-to-br from-[var(--accent)]/20 to-transparent border border-[var(--accent-soft)] right-col-item glass-highlight special-card" [class.loaded]="cardsLoaded()">
                          <div class="flex items-start gap-2">
                            <svg class="w-4 h-4 text-[var(--accent)] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/>
                            </svg>
                            <div>
                              <p class="text-xs font-semibold text-[var(--accent)] uppercase">Special</p>
                              <p class="text-xs text-[var(--text)] mt-0.5">{{ profile.specialOffer }}</p>
                            </div>
                          </div>
                        </div>
                      }

                      <!-- Testimonial -->
                      @if (profile.testimonials && profile.testimonials.length > 0) {
                        <div class="glass-panel rounded-xl p-4 right-col-item glass-highlight testimonial-card" [class.loaded]="cardsLoaded()">
                          <div class="flex items-center gap-1 mb-1.5">
                            @for (star of [1,2,3,4,5]; track star) {
                              <svg class="w-2.5 h-2.5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                              </svg>
                            }
                          </div>
                          <p class="text-xs text-[var(--muted)] italic line-clamp-3">"{{ profile.testimonials[0] }}"</p>
                          <p class="text-xs text-[var(--muted)]/70 mt-1">— Verified</p>
                        </div>
                      }
                    </div>
                  </div>
                }
              }
            </div>

            @if (showHeroGallery()) {
              <div class="fixed inset-0 z-40 flex items-center justify-center p-4 bg-black/70 backdrop-blur-md">
                <div class="relative w-full max-w-5xl bg-[rgba(12,15,26,0.9)] border border-white/10 rounded-3xl shadow-2xl overflow-hidden">
                  <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                    <div>
                      <p class="text-xs uppercase tracking-[0.35em] text-[var(--muted)]">Hero Gallery</p>
                      <p class="text-lg font-semibold text-[var(--text)]">Images for {{ featured.name }}</p>
                    </div>
                    <button (click)="closeHeroGallery()" class="text-[var(--text)]/80 hover:text-white transition-colors rounded-full p-2 hover:bg-white/10">
                      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m6 6 12 12M6 18 18 6"/>
                      </svg>
                    </button>
                  </div>
                  <div class="max-h-[70vh] overflow-y-auto p-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    @for (image of featured.gallery; track image) {
                      <div class="group relative overflow-hidden rounded-2xl border border-white/5 bg-white/5">
                        <img [src]="image" [alt]="featured.name + ' gallery image'" class="w-full h-52 object-cover transition duration-500 group-hover:scale-105" loading="lazy">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/10 to-transparent opacity-0 group-hover:opacity-100 transition duration-400"></div>
                        <div class="absolute bottom-0 left-0 right-0 p-3 text-sm text-white/90 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition duration-400">
                          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7h18M3 17h18M8 12h8"/>
                          </svg>
                          Hero Visual {{ $index + 1 }}
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </div>
            }

            <!-- Bottom Navigation Bar -->
            <div class="absolute bottom-0 left-0 right-0 px-4 md:px-8 lg:px-12 pb-8 z-20">
                <div class="container mx-auto flex justify-between items-center text-[var(--muted)]">
                    <!-- Prev Profile Name -->
                    <div class="w-1/3 text-left flex items-center gap-3">
                        <span class="text-xs uppercase tracking-widest opacity-50">{{ prevProfileName() }}</span>
                        <button 
                          (click)="prevProfile()" 
                          class="hidden sm:inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-[var(--text)]/80 border border-[var(--accent-soft)] hover:bg-[var(--btn-bg)] hover:text-[var(--btn-text)] hover:border-[var(--btn-border)] transition-colors text-xs">
                          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"/>
                          </svg>
                          Prev
                        </button>
                    </div>
                    <!-- Slider Dots -->
                    <div class="flex items-center gap-4">
                        @for (profile of profiles(); track profile.id; let i = $index) {
                            <button (click)="featuredIndex.set(i)" 
                                    class="h-1 rounded-full transition-all duration-500 ease-in-out"
                                    [class.bg-white]="i === featuredIndex()"
                                    [class.w-8]="i === featuredIndex()"
                                    [class.bg-slate-600]="i !== featuredIndex()"
                                    [class.w-2]="i !== featuredIndex()">
                            </button>
                        }
                    </div>
                    <!-- Next Profile Name -->
                    <div class="w-1/3 flex items-center justify-end gap-3">
                        <span class="text-xs uppercase tracking-widest opacity-50">{{ nextProfileName() }}</span>
                        <button 
                          (click)="nextProfile()" 
                          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-[var(--text)]/80 border border-[var(--accent-soft)] hover:bg-[var(--btn-bg)] hover:text-[var(--btn-text)] hover:border-[var(--btn-border)] transition-colors text-xs font-semibold">
                          Next Model
                          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"/>
                          </svg>
                        </button>
                    </div>
                </div>
            </div>
          </section>
        

        <!-- Search Section -->
        <section class="px-4 md:px-8 lg:px-12 py-16">
          <div class="max-w-2xl mx-auto relative section-panel">
              <div class="absolute inset-y-0 left-0 pl-6 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-[var(--muted)]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
              </div>
              <input 
                type="text" 
                [value]="promptText()"
                (input)="handlePromptChange($event)"
                placeholder="Filter by name, city, interest..."
                class="w-full text-lg font-light bg-black/20 backdrop-blur-xl border border-[var(--accent-soft)] rounded-full py-4 pl-14 pr-6 text-[var(--text)] placeholder-[var(--muted)] focus:outline-none transition duration-300 dynamic-focus-ring">
            </div>
        </section>

        <!-- Profile Grid -->
        <section class="px-4 md:px-8 lg:px-12 pb-16">
          <div class="section-panel">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
            @for (profile of filteredProfiles(); track profile.id) {
              <app-profile-card 
                [profile]="profile" 
                (selectProfile)="selectProfile($event)" 
              />
            }
            </div>
            @if (filteredProfiles().length === 0) {
              <div class="text-center py-20">
                  <p class="text-[var(--muted)]">No profiles match your search.</p>
              </div>
            }
          </div>
        </section>
      }
    </main>
  </div>
}
